<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_25) on Sun Apr 19 17:27:53 MYT 2015 -->
<title>ManualCMSGenerator</title>
<meta name="date" content="2015-04-19">
<link rel="stylesheet" type="text/css"
	href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
	<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="ManualCMSGenerator";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
	<noscript>
		<div>JavaScript is disabled on your browser.</div>
	</noscript>
	<!-- ========= START OF TOP NAVBAR ======= -->
	<div class="topNav">
		<a name="navbar.top"> <!--   -->
		</a>
		<div class="skipNav">
			<a href="#skip.navbar.top" title="Skip navigation links">Skip
				navigation links</a>
		</div>
		<a name="navbar.top.firstrow"> <!--   -->
		</a>
		<ul class="navList" title="Navigation">
			<li><a href="../../../../../overview-summary.html">Overview</a></li>
			<li><a href="package-summary.html">Package</a></li>
			<li class="navBarCell1Rev">Class</li>
			<li><a href="class-use/ManualCMSGenerator.html">Use</a></li>
			<li><a href="package-tree.html">Tree</a></li>
			<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
			<li><a href="../../../../../index-files/index-1.html">Index</a></li>
			<li><a href="../../../../../help-doc.html">Help</a></li>
		</ul>
	</div>
	<div class="subNav">
		<ul class="navList">
			<li>Prev&nbsp;Class</li>
			<li><a
				href="../../../../../tools/pki/gbay/hardware/cms/ManualSignerInfoGenerator.html"
				title="class in tools.pki.gbay.hardware.cms"><span
					class="typeNameLink">Next&nbsp;Class</span></a></li>
		</ul>
		<ul class="navList">
			<li><a
				href="../../../../../index.html?tools/pki/gbay/hardware/cms/ManualCMSGenerator.html"
				target="_top">Frames</a></li>
			<li><a href="ManualCMSGenerator.html" target="_top">No&nbsp;Frames</a></li>
		</ul>
		<ul class="navList" id="allclasses_navbar_top">
			<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
		</ul>
		<div>
			<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
		</div>
		<div>
			<ul class="subNavList">
				<li>Summary:&nbsp;</li>
				<li>Nested&nbsp;|&nbsp;</li>
				<li>Field&nbsp;|&nbsp;</li>
				<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
				<li><a href="#method.summary">Method</a></li>
			</ul>
			<ul class="subNavList">
				<li>Detail:&nbsp;</li>
				<li>Field&nbsp;|&nbsp;</li>
				<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
				<li><a href="#method.detail">Method</a></li>
			</ul>
		</div>
		<a name="skip.navbar.top"> <!--   -->
		</a>
	</div>
	<!-- ========= END OF TOP NAVBAR ========= -->
	<!-- ======== START OF CLASS DATA ======== -->
	<div class="header">
		<div class="subTitle">tools.pki.gbay.hardware.cms</div>
		<h2 title="Class ManualCMSGenerator" class="title">Class
			ManualCMSGenerator</h2>
	</div>
	<div class="contentContainer">
		<ul class="inheritance">
			<li>java.lang.Object</li>
			<li>
				<ul class="inheritance">
					<li>tools.pki.gbay.hardware.cms.ManualCMSGenerator</li>
				</ul>
			</li>
		</ul>
		<div class="description">
			<ul class="blockList">
				<li class="blockList">
					<hr> <br> <pre>public class <span
							class="typeNameLabel">ManualCMSGenerator</span>
extends java.lang.Object</pre>
					<div class="block">
						A class for generating a CMS (PKCS#7) signature message, where
						encryption procedure is done out-side.
						<p>
							This enables the use of cryptographic tokens, such as Smart
							Cards, where private key is not extractable and encryption has to
							be done on the token. <br> This has also the effect of
							completely separate the digest encryption process from the
							message encapsulation. This is useful in signing environments,
							such as applets, where is desirable to avoid the wheight of the
							provider and cms library classes. See
							<code>it.trento.comune.j4sign.examples.SimpleSignApplet</code>
						<p>
							<code>ManualCMSGenerator</code>
							is an alternative implementation of
							<code>org.bouncycastle.cms.CMSSignedDataGenerator</code>
							. <br> Alternative implementation has been preferred to
							subclassing, because the signer info generator inner class has
							been promoted to the indipendent <a
								href="../../../../../tools/pki/gbay/hardware/cms/ManualSignerInfoGenerator.html"
								title="class in tools.pki.gbay.hardware.cms"><code>ManualSignerInfoGenerator</code></a>.
						
						<p>Here follows an example of usage:
						<pre>
 
   ManualCMSGenerator gen = new ManualCMSGenerator();
                        
   //<a
								href="../../../../../tools/pki/gbay/hardware/cms/ManualSignerInfoGenerator.html"
								title="class in tools.pki.gbay.hardware.cms"><code>ManualSignerInfoGenerator</code></a> encapsulates SignerInfos,
   //and is used in <a
								href="../../../../../tools/pki/gbay/hardware/cms/ManualCMSGenerator.html#generate-org.bouncycastle.cms.CMSProcessable-boolean-"><code>generate(org.bouncycastle.cms.CMSProcessable, boolean)</code></a> method.
  
   ManualSignerInfoGenerator signerGenerator = new ManualSignerInfoGenerator(
                                                                CMSSignedDataGenerator.DIGEST_MD5,
                                                                CMSSignedDataGenerator.ENCRYPTION_RSA);
   try {
       //Obtain bytes to sign; 
       //note that this implementation includes a timestamp
       //as an authenticated attribute, then bytesToSign is every time different, 
       //even if signing the same data.
       //The timestamp should be notified and accepted by the signer along data to sign
       //BEFORE he applies encryption with his private key.
       //The timestamp is used during verification to check that signature time is 
       //in signing certificate validity time range.
  
       byte[] bytesToSign = signerGenerator.getBytesToSign(PKCSObjectIdentifiers.data, msg, &quot;BC&quot;);
                                                                
       // Digest generation. Digest algorithm must match the one passed to ManualSignerInfoGenerator
       // constructor above (MD5, in this case).
       MessageDigest md = MessageDigest.getInstance(&quot;MD5&quot;);
       md.update(bytesToSign);
       byte[] digest = md.digest();
                                        
       byte[] signedBytes = null;  //will contain encripted digest
       byte[] certBytes = null; //will contain DER encoded certificate
  
       //Digest encryption and signer certificate retrieval (using a PKCS11 token, for example)
       // Encryption algorithm must match the one passed to ManualSignerInfoGenerator
       // constructor above (RSA, in this case).
                           .
                           .    
                           .
  
       if ((certBytes != null) &amp;&amp; (signedBytes != null)) {
                        
           //build java Certificate object. 
           java.security.cert.CertificateFactory cf = 
                               java.security.cert.CertificateFactory.getInstance(&quot;X.509&quot;);
           java.io.ByteArrayInputStream bais = new java.io.ByteArrayInputStream(certBytes);
           java.security.cert.X509Certificate javaCert = 
                                        (java.security.cert.X509Certificate) cf.generateCertificate(bais);
                                                                                        
           //pass encrypted digest and certificate to the SignerInfo generator
           signerGenerator.setCertificate(javaCert);
           signerGenerator.setSignedBytes(signedBytes);
 
           //pass the signer info generator to the cms generator
           gen.addSignerInf(signerGenerator);
                                                                
           //generating a cert store with signer certificate into.
           //The store could contain also the root certificate and CRLS
           ArrayList certList = new ArrayList();
           certList.add(javaCert);
                        CertStore store = CertStore.getInstance(&quot;Collection&quot;,
                                                   new CollectionCertStoreParameters(certList), 
                                                   &quot;BC&quot;);
           //pass cert store to the cms generator
           gen.addCertificatesAndCRLs(store);
                
           //Finally, generate CMS message.
           CMSSignedData s = gen.generate(msg, true);
       }
    } catch (Exception ex) {
            ...Exception mangement ...
    }
 </pre>
					</div>
					<dl>
						<dt>
							<span class="simpleTagLabel">Version:</span>
						</dt>
						<dd>$Revision: 1.1 $ $Date: 2004/12/27 11:14:34 $</dd>
						<dt>
							<span class="simpleTagLabel">Author:</span>
						</dt>
						<dd>Araz Farhang</dd>
					</dl>
				</li>
			</ul>
		</div>
		<div class="summary">
			<ul class="blockList">
				<li class="blockList">
					<!-- ======== CONSTRUCTOR SUMMARY ======== -->
					<ul class="blockList">
						<li class="blockList"><a name="constructor.summary"> <!--   -->
						</a>
							<h3>Constructor Summary</h3>
							<table class="memberSummary" border="0" cellpadding="3"
								cellspacing="0"
								summary="Constructor Summary table, listing constructors, and an explanation">
								<caption>
									<span>Constructors</span><span class="tabEnd">&nbsp;</span>
								</caption>
								<tr>
									<th class="colOne" scope="col">Constructor and Description</th>
								</tr>
								<tr class="altColor">
									<td class="colOne"><code>
											<span class="memberNameLink"><a
												href="../../../../../tools/pki/gbay/hardware/cms/ManualCMSGenerator.html#ManualCMSGenerator--">ManualCMSGenerator</a></span>()
										</code>&nbsp;</td>
								</tr>
							</table></li>
					</ul> <!-- ========== METHOD SUMMARY =========== -->
					<ul class="blockList">
						<li class="blockList"><a name="method.summary"> <!--   -->
						</a>
							<h3>Method Summary</h3>
							<table class="memberSummary" border="0" cellpadding="3"
								cellspacing="0"
								summary="Method Summary table, listing methods, and an explanation">
								<caption>
									<span id="t0" class="activeTableTab"><span>All
											Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2"
										class="tableTab"><span><a
											href="javascript:show(2);">Instance Methods</a></span><span
										class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a
											href="javascript:show(8);">Concrete Methods</a></span><span
										class="tabEnd">&nbsp;</span></span>
								</caption>
								<tr>
									<th class="colFirst" scope="col">Modifier and Type</th>
									<th class="colLast" scope="col">Method and Description</th>
								</tr>
								<tr id="i0" class="altColor">
									<td class="colFirst"><code>void</code></td>
									<td class="colLast"><code>
											<span class="memberNameLink"><a
												href="../../../../../tools/pki/gbay/hardware/cms/ManualCMSGenerator.html#addCertificatesAndCRLs-java.security.cert.CertStore-">addCertificatesAndCRLs</a></span>(java.security.cert.CertStore&nbsp;certStore)
										</code>
										<div class="block">add the certificates and CRLs
											contained in the given CertStore to the pool that will be
											included in the encoded signature block.</div></td>
								</tr>
								<tr id="i1" class="rowColor">
									<td class="colFirst"><code>void</code></td>
									<td class="colLast"><code>
											<span class="memberNameLink"><a
												href="../../../../../tools/pki/gbay/hardware/cms/ManualCMSGenerator.html#addSignerInf-tools.pki.gbay.hardware.cms.ManualSignerInfoGenerator-">addSignerInf</a></span>(<a
												href="../../../../../tools/pki/gbay/hardware/cms/ManualSignerInfoGenerator.html"
												title="class in tools.pki.gbay.hardware.cms">ManualSignerInfoGenerator</a>&nbsp;si)
										</code>
										<div class="block">
											adds all the information necessary to build the
											<code>org.bouncycastle.asn1.cms.SignerInfo</code>
											about a signer.
										</div></td>
								</tr>
								<tr id="i2" class="altColor">
									<td class="colFirst"><code>org.bouncycastle.cms.CMSSignedData</code></td>
									<td class="colLast"><code>
											<span class="memberNameLink"><a
												href="../../../../../tools/pki/gbay/hardware/cms/ManualCMSGenerator.html#generate-org.bouncycastle.cms.CMSProcessable-boolean-">generate</a></span>(org.bouncycastle.cms.CMSProcessable&nbsp;content,
											boolean&nbsp;encapsulate)
										</code>
										<div class="block">
											generate a CMS Signed Data object using the previously passed
											<a
												href="../../../../../tools/pki/gbay/hardware/cms/ManualSignerInfoGenerator.html"
												title="class in tools.pki.gbay.hardware.cms"><code>ManualSignerInfoGenerator</code></a>
											objects; if encapsulate is true a copy of the message will be
											included in the signature.
										</div></td>
								</tr>
							</table>
							<ul class="blockList">
								<li class="blockList"><a
									name="methods.inherited.from.class.java.lang.Object"> <!--   -->
								</a>
									<h3>Methods inherited from class&nbsp;java.lang.Object</h3> <code>equals,
										getClass, hashCode, notify, notifyAll, toString, wait, wait,
										wait</code></li>
							</ul></li>
					</ul>
				</li>
			</ul>
		</div>
		<div class="details">
			<ul class="blockList">
				<li class="blockList">
					<!-- ========= CONSTRUCTOR DETAIL ======== -->
					<ul class="blockList">
						<li class="blockList"><a name="constructor.detail"> <!--   -->
						</a>
							<h3>Constructor Detail</h3> <a name="ManualCMSGenerator--"> <!--   -->
						</a>
							<ul class="blockListLast">
								<li class="blockList">
									<h4>ManualCMSGenerator</h4> <pre>public&nbsp;ManualCMSGenerator()</pre>
								</li>
							</ul></li>
					</ul> <!-- ============ METHOD DETAIL ========== -->
					<ul class="blockList">
						<li class="blockList"><a name="method.detail"> <!--   -->
						</a>
							<h3>Method Detail</h3> <a
							name="addCertificatesAndCRLs-java.security.cert.CertStore-">
								<!--   -->
						</a>
							<ul class="blockList">
								<li class="blockList">
									<h4>addCertificatesAndCRLs</h4> <pre>public&nbsp;void&nbsp;addCertificatesAndCRLs(java.security.cert.CertStore&nbsp;certStore)
                            throws java.security.cert.CertStoreException,
                                   org.bouncycastle.cms.CMSException</pre>
									<div class="block">
										add the certificates and CRLs contained in the given CertStore
										to the pool that will be included in the encoded signature
										block.
										<p>Note: this assumes the CertStore will support null in
											the get methods.
									</div>
									<dl>
										<dt>
											<span class="paramLabel">Parameters:</span>
										</dt>
										<dd>
											<code>certStore</code>
											- Certificate store which contains certs and CRL
										</dd>
										<dt>
											<span class="throwsLabel">Throws:</span>
										</dt>
										<dd>
											<code>java.security.cert.CertStoreException</code>
											- Error in opening store
										</dd>
										<dd>
											<code>org.bouncycastle.cms.CMSException</code>
										</dd>
									</dl>
								</li>
							</ul> <a
							name="addSignerInf-tools.pki.gbay.hardware.cms.ManualSignerInfoGenerator-">
								<!--   -->
						</a>
							<ul class="blockList">
								<li class="blockList">
									<h4>addSignerInf</h4> <pre>public&nbsp;void&nbsp;addSignerInf(<a
											href="../../../../../tools/pki/gbay/hardware/cms/ManualSignerInfoGenerator.html"
											title="class in tools.pki.gbay.hardware.cms">ManualSignerInfoGenerator</a>&nbsp;si)</pre>
									<div class="block">
										adds all the information necessary to build the
										<code>org.bouncycastle.asn1.cms.SignerInfo</code>
										about a signer.
									</div>
									<dl>
										<dt>
											<span class="paramLabel">Parameters:</span>
										</dt>
										<dd>
											<code>si</code>
											- - the <a
												href="../../../../../tools/pki/gbay/hardware/cms/ManualSignerInfoGenerator.html"
												title="class in tools.pki.gbay.hardware.cms"><code>ManualSignerInfoGenerator</code></a>object
											that ownes informations about a single signer.
										</dd>
									</dl>
								</li>
							</ul> <a name="generate-org.bouncycastle.cms.CMSProcessable-boolean-">
								<!--   -->
						</a>
							<ul class="blockListLast">
								<li class="blockList">
									<h4>generate</h4> <pre>public&nbsp;org.bouncycastle.cms.CMSSignedData&nbsp;generate(org.bouncycastle.cms.CMSProcessable&nbsp;content,
                                                   boolean&nbsp;encapsulate)
                                            throws java.security.NoSuchAlgorithmException,
                                                   java.security.NoSuchProviderException,
                                                   org.bouncycastle.cms.CMSException,
                                                   java.security.InvalidAlgorithmParameterException,
                                                   java.security.cert.CertStoreException</pre>
									<div class="block">
										generate a CMS Signed Data object using the previously passed
										<a
											href="../../../../../tools/pki/gbay/hardware/cms/ManualSignerInfoGenerator.html"
											title="class in tools.pki.gbay.hardware.cms"><code>ManualSignerInfoGenerator</code></a>
										objects; if encapsulate is true a copy of the message will be
										included in the signature.
									</div>
									<dl>
										<dt>
											<span class="paramLabel">Parameters:</span>
										</dt>
										<dd>
											<code>content</code>
											- real content
										</dd>
										<dd>
											<code>encapsulate</code>
											- true if you want to put the original data in CMS
										</dd>
										<dt>
											<span class="returnLabel">Returns:</span>
										</dt>
										<dd>CMS Signed data</dd>
										<dt>
											<span class="throwsLabel">Throws:</span>
										</dt>
										<dd>
											<code>java.security.NoSuchAlgorithmException</code>
										</dd>
										<dd>
											<code>java.security.NoSuchProviderException</code>
										</dd>
										<dd>
											<code>org.bouncycastle.cms.CMSException</code>
										</dd>
										<dd>
											<code>java.security.InvalidAlgorithmParameterException</code>
										</dd>
										<dd>
											<code>java.security.cert.CertStoreException</code>
										</dd>
									</dl>
								</li>
							</ul></li>
					</ul>
				</li>
			</ul>
		</div>
	</div>
	<!-- ========= END OF CLASS DATA ========= -->
	<!-- ======= START OF BOTTOM NAVBAR ====== -->
	<div class="bottomNav">
		<a name="navbar.bottom"> <!--   -->
		</a>
		<div class="skipNav">
			<a href="#skip.navbar.bottom" title="Skip navigation links">Skip
				navigation links</a>
		</div>
		<a name="navbar.bottom.firstrow"> <!--   -->
		</a>
		<ul class="navList" title="Navigation">
			<li><a href="../../../../../overview-summary.html">Overview</a></li>
			<li><a href="package-summary.html">Package</a></li>
			<li class="navBarCell1Rev">Class</li>
			<li><a href="class-use/ManualCMSGenerator.html">Use</a></li>
			<li><a href="package-tree.html">Tree</a></li>
			<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
			<li><a href="../../../../../index-files/index-1.html">Index</a></li>
			<li><a href="../../../../../help-doc.html">Help</a></li>
		</ul>
	</div>
	<div class="subNav">
		<ul class="navList">
			<li>Prev&nbsp;Class</li>
			<li><a
				href="../../../../../tools/pki/gbay/hardware/cms/ManualSignerInfoGenerator.html"
				title="class in tools.pki.gbay.hardware.cms"><span
					class="typeNameLink">Next&nbsp;Class</span></a></li>
		</ul>
		<ul class="navList">
			<li><a
				href="../../../../../index.html?tools/pki/gbay/hardware/cms/ManualCMSGenerator.html"
				target="_top">Frames</a></li>
			<li><a href="ManualCMSGenerator.html" target="_top">No&nbsp;Frames</a></li>
		</ul>
		<ul class="navList" id="allclasses_navbar_bottom">
			<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
		</ul>
		<div>
			<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
		</div>
		<div>
			<ul class="subNavList">
				<li>Summary:&nbsp;</li>
				<li>Nested&nbsp;|&nbsp;</li>
				<li>Field&nbsp;|&nbsp;</li>
				<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
				<li><a href="#method.summary">Method</a></li>
			</ul>
			<ul class="subNavList">
				<li>Detail:&nbsp;</li>
				<li>Field&nbsp;|&nbsp;</li>
				<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
				<li><a href="#method.detail">Method</a></li>
			</ul>
		</div>
		<a name="skip.navbar.bottom"> <!--   -->
		</a>
	</div>
	<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
